<!-- Секция с картой -->
<div class="mt-8 md:mt-16 lg:mt-20 max-w-[1200px] mx-auto w-full my-[60px]">
  
  <!-- Скрипт для передачи данных офисов в глобальную переменную -->
  <script>
    // Инициализируем глобальную переменную для данных офисов
    window.officesData = window.officesData || {};
    
    // Если на странице есть данные офисов из Vite, добавляем их в глобальную переменную
    {{#if ../offices}}
    window.officesData.offices = [
      {{#each ../offices}}
      {
        city: "{{city}}",
        address: "{{address}}",
        type: "{{type}}",
        phone: "{{phone}}",
        email: "{{email}}",
        coordinates: [{{coordinates.[0]}}, {{coordinates.[1]}}]
      }{{#unless @last}},{{/unless}}
      {{/each}}
    ];
    {{/if}}
    
    // Если выбран офис по умолчанию, также добавляем его
    {{#if ../selectedOffice}}
    window.officesData.selectedOffice = {
      city: "{{../selectedOffice.city}}",
      address: "{{../selectedOffice.address}}",
      type: "{{../selectedOffice.type}}",
      phone: "{{../selectedOffice.phone}}",
      email: "{{../selectedOffice.email}}",
      coordinates: [{{../selectedOffice.coordinates.[0]}}, {{../selectedOffice.coordinates.[1]}}]
    };
    window.officesData.selectedOfficeIndex = {{../selectedOfficeIndex}};
    {{/if}}
    
    // Если есть офис по умолчанию, также добавляем его
    {{#if defaultOffice}}
    window.officesData.defaultOffice = {
      city: "{{defaultOffice.city}}",
      address: "{{defaultOffice.address}}",
      type: "{{defaultOffice.type}}",
      phone: "{{defaultOffice.phone}}",
      email: "{{defaultOffice.email}}",
      coordinates: [{{defaultOffice.coordinates.[0]}}, {{defaultOffice.coordinates.[1]}}]
    };
    {{/if}}
  </script>
  
  <!-- Интерактивная карта -->
  <div class="relative w-full rounded-lg">
    <!-- Контейнер для Leaflet карты -->
    <div id="map" class="w-full h-[80vh] md:h-[500px] min-h-[400px] rounded-2xl bg-gray-100 z-10">
      <!-- Стиль для скрытия атрибуции на мобильных устройствах -->
      <style>
        @media (max-width: 768px) {
          .leaflet-control-attribution {
            @apply hidden;
          }
        }
      </style>
    </div>
    
    <!-- Информационная панель с данными офиса -->
    <div class="map-info-panel min-w-[300px] absolute bottom-4 md:top-5 md:auto md:right-6 md:left-auto md:translate-x-0 md:translate-y-0 left-4  right-4 md:w-[30%] bg-white rounded-2xl shadow-xl md:shadow-lg p-4 md:p-10 flex flex-col gap-1 md:gap-2 overflow-y-auto {{#unless selectedOffice}}{{#unless defaultOffice}}hidden{{/unless}}{{/unless}} z-10">
      {{#if selectedOffice}}
      <div class="flex justify-end items-center mb-2">
        <button class="text-brand-gray hover:text-brand-blue transition-colors close-info-panel">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
      <div class="font-bold text-2xl text-brand-gray">{{selectedOffice.city}}</div>
      <div class="text-brand-gray">{{selectedOffice.address}}</div>
      <div class="text-brand-gray">{{selectedOffice.type}}</div>
      <div class="text-brand-gray">{{selectedOffice.phone}}</div>
      <div class="text-brand-gray">{{selectedOffice.email}}</div>
      <button class="bg-brand-blue mt-5 text-white rounded-lg py-3 text-buttons text-regular hover:bg-blue-700 transition-colors">Подробнее</button>
      {{else}}
      {{#if defaultOffice}}
      <div class="flex justify-end items-center mb-2">
        <button class="text-brand-gray hover:text-brand-blue transition-colors close-info-panel">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
      <div class="font-bold text-2xl text-brand-gray">{{defaultOffice.city}}</div>
      <div class="text-brand-gray">{{defaultOffice.address}}</div>
      <div class="text-brand-gray">{{defaultOffice.type}}</div>
      <div class="text-brand-gray">{{defaultOffice.phone}}</div>
      <div class="text-brand-gray">{{defaultOffice.email}}</div>
      <button class="bg-brand-blue mt-5 text-white rounded-lg py-3 text-buttons text-regular hover:bg-blue-700 transition-colors">Подробнее</button>
      {{else}}
      <!-- Содержимое будет заполнено через JavaScript -->
      {{/if}}
      {{/if}}
    </div>
  </div>
  
  <!-- Подключение стилей и скриптов для карты -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script src="{{basePath}}assets/js/map.js"></script>
</div> 